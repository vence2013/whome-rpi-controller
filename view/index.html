<html>
<head>
    <title>rpi controller</title>
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css" />
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>

    <link rel="stylesheet" href="./css/index.css" />
    <script src="./js/index.js"></script>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <div class="row">
                    <div class="col">
                        <button type="button" class="btn btn-secondary btn-lg btn-block">水泵开关</button>
                    </div>
                    <div class="col">
                        <button type="button" class="btn btn-secondary btn-lg btn-block">滴灌开关</button>
                    </div>                                        
                </div>
            </div>
            <div class="col">
                士大夫大师傅
            </div>
        </div>
        <div class="row">
            <div class="col-4 border rounded m-2">
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="ctl1" onclick="gpio_set(15);">
                    <label class="custom-control-label" for="ctl1">水泵开关</label>
                </div>
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="ctl2" onclick="gpio_set(16);">
                    <label class="custom-control-label" for="ctl2">滴灌阀门</label>
                </div>     
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="ctl3" onclick="gpio_set(31);">
                    <label class="custom-control-label" for="ctl2">测试控制</label>
                </div>                               
            </div>
            <div class="col mr-2 mt-2">
                <%=name%><br />
                水位检测：<span id="water"></span><br />
                土壤检测：<span id="solid"></span>
            </div>
        </div>
    </div>
</body>
</html>
<script>
function gpio_set(pin)
{
    let val;

    if (15 == pin)
        val = $("#ctl1").is(':checked') ? 1 : 0;
    else if (16 == pin)
        val = $("#ctl2").is(':checked') ? 1 : 0;
    else 
        val = $("#ctl3").is(':checked') ? 1 : 0;

    console.log(pin, val);
    $.get("/gpio/"+pin+"?set="+val, (res) => {
        console.log(res);
    });
}

function status_query()
{
    $.get("/status", (res) => {
        console.log(res);
        $("#water").text(res.water);
        $("#solid").text(res.solid);
    });
}

$(document).ready(() => {
    window.setInterval(status_query, 3000);
});
</script>